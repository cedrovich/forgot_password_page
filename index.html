<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Reset Password</title>
</head>
<body>
  <h1>Reset Your Password</h1>

  <!-- Formulario para ingresar nueva contraseña -->
  <form id="reset-password-form">
    <label for="new-password">New Password:</label>
    <input type="password" id="new-password" name="new-password" required>
    <button type="submit">Reset Password</button>
  </form>

  <div id="message"></div>

  <script type="module">
    import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js/+esm';

    // Configuración de Supabase
    const supabaseUrl = 'https://pggtliopkuymentnklow.supabase.co';
    const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InBnZ3RsaW9wa3V5bWVudG5rbG93Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzI2MzE4OTcsImV4cCI6MjA0ODIwNzg5N30.HO87zVfpPOwBh0Cj0YVp2LowCHM750W49tbSmNkzfYQ'; // Reemplaza con tu clave pública
    const supabase = createClient(supabaseUrl, supabaseKey);

    // Captura el token de la URL
    const urlParams = new URLSearchParams(window.location.search);
    const accessToken = urlParams.get('access_token');

    // Si no hay token, muestra un error
    if (!accessToken) {
      document.getElementById('message').innerText = 'Error: Invalid or missing token.';
      document.getElementById('reset-password-form').style.display = 'none';
    }

    // Función para cambiar la contraseña
    async function resetPassword(event) {
      event.preventDefault();

      const newPassword = document.getElementById('new-password').value;

      try {
        const { error } = await supabase.auth.updateUser(
          { password: newPassword },
          { accessToken } // Usa el token capturado
        );

        if (error) {
          console.error('Error resetting password:', error);
          document.getElementById('message').innerText = `Error: ${error.message}`;
        } else {
          console.log('Password reset successfully');
          document.getElementById('message').innerText = 'Password reset successfully!';
          document.getElementById('reset-password-form').style.display = 'none';
        }
      } catch (err) {
        console.error('Unexpected error:', err);
        document.getElementById('message').innerText = `Unexpected Error: ${err.message}`;
      }
    }

    // Asigna la función al formulario
    document.getElementById('reset-password-form').addEventListener('submit', resetPassword);
  </script>
</body>
</html>
